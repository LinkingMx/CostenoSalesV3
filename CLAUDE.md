# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Laravel React Starter Kit (CostenoSalesV3) - a full-stack application using Laravel 12 as the backend with React 19 frontend via Inertia.js. The project uses modern TypeScript, TailwindCSS v4, and is structured for server-side rendering support.

## Key Technologies

- **Backend**: Laravel 12 (PHP 8.2+), Inertia.js Laravel adapter
- **Frontend**: React 19, TypeScript, Inertia.js React adapter
- **Styling**: TailwindCSS v4, shadcn/ui components (New York style)
- **Build Tools**: Vite with Laravel plugin, Wayfinder plugin for form generation
- **Testing**: Pest (PHP), PHPUnit configuration available
- **Linting/Formatting**: Laravel Pint (PHP), ESLint + Prettier (JS/TS)

## Development Commands

### Backend
- `composer dev` - Start full development server (Laravel + queue + logs + Vite)
- `composer dev:ssr` - Start with SSR support
- `composer test` - Run PHP tests with Pest
- `vendor/bin/pint` - Fix PHP code style
- `php artisan serve` - Start Laravel server only

### Frontend
- `npm run dev` - Start Vite development server
- `npm run build` - Build for production
- `npm run build:ssr` - Build with SSR support
- `npm run lint` - Lint and fix JavaScript/TypeScript
- `npm run format` - Format code with Prettier
- `npm run format:check` - Check formatting without changes
- `npm run types` - Run TypeScript type checking

### Testing
- `./vendor/bin/pest` - Run PHP tests
- `composer test` - Run tests with config clearing

## Architecture Overview

### Backend Structure
- **Controllers**: Standard Laravel controllers with Inertia responses
- **Authentication**: Complete auth system with password resets, email verification
- **Middleware**: Custom `HandleInertiaRequests` and `HandleAppearance` middleware
- **Routes**: Split across `web.php`, `auth.php`, and `settings.php`

### Frontend Structure
- **Pages**: Located in `resources/js/pages/` with auth, settings, and main app pages
- **Components**: Custom components in `resources/js/components/` plus shadcn/ui components
- **Layouts**: Flexible layout system with auth and app layouts
- **Actions**: Type-safe route actions generated by Wayfinder in `resources/js/actions/`
- **Hooks**: Custom React hooks for mobile detection, appearance, etc.

### Key Features
- **Inertia.js Integration**: Full SPA experience with server-side routing
- **SSR Support**: Server-side rendering capability built-in
- **Type Safety**: TypeScript throughout with path aliases (`@/*` → `resources/js/*`)
- **Component Library**: shadcn/ui components with Radix UI primitives
- **Appearance System**: Dark/light mode with system preference detection
- **Form Variants**: Wayfinder plugin generates type-safe form handling

## File Organization

### Frontend Paths (TypeScript aliases available):
- `@/components` → `resources/js/components`
- `@/lib` → `resources/js/lib`
- `@/hooks` → `resources/js/hooks`
- `@/pages` → `resources/js/pages`
- `@/layouts` → `resources/js/layouts`

### Important Files:
- `vite.config.ts` - Vite configuration with React, TailwindCSS, and Wayfinder
- `eslint.config.js` - ESLint configuration for React/TypeScript
- `tsconfig.json` - TypeScript configuration with strict mode
- `components.json` - shadcn/ui configuration
- `phpunit.xml` - PHP testing configuration

## Code Style & Quality

### PHP
- Uses Laravel Pint for code formatting (PSR-12 standard)
- Pest framework for testing with PHPUnit fallback

### JavaScript/TypeScript
- ESLint with React hooks rules and TypeScript support
- Prettier for code formatting with import organization
- Strict TypeScript configuration enabled
- React 19 with automatic JSX runtime

## CI/CD

GitHub Actions workflows configured for:
- **Linting**: Runs Pint (PHP) and ESLint/Prettier (JS/TS)
- **Testing**: Runs Pest tests with PHP 8.4 and Node.js 22

Both workflows run on pushes and PRs to `main` and `develop` branches.

## Testing Credentials

For Playwright testing, use the following test user:
- **Email**: armando.reyes@grupocosteno.com
- **Password**: C@sten0.2019+

## Custom Components

### MainFilterCalendar Component

A comprehensive Spanish-localized date range selector component built for CostenoSalesV3. This component provides both quick period selection and manual calendar-based date range selection.

**Location**: `@/components/main-filter-calendar`

**Key Features**:
- **Spanish Localization**: Complete Spanish UI with months, days, and text
- **Quick Periods**: Predefined date ranges organized in groups (Diarios, Semanales, Mensuales)
- **Manual Selection**: Interactive calendar for custom date ranges
- **Auto-initialization**: Defaults to today's date on component mount
- **Integrated Refresh**: Built-in page refresh functionality

**Architecture**:
```
main-filter-calendar/
├── main-filter-calendar.tsx    # Core component with h-9 height, compact spacing
├── types.ts                    # TypeScript interfaces (DateRange, PeriodType, etc.)
├── utils.ts                    # Spanish constants & date utilities
├── hooks/use-date-range.ts     # Centralized state management hook
└── components/
    ├── period-selector.tsx     # Grouped quick selection dropdown
    ├── calendar-view.tsx       # Interactive calendar with gray color scheme
    └── refresh-button.tsx      # h-9 w-9 refresh button
```

**Usage Example**:
```tsx
import { MainFilterCalendar, type DateRange } from '@/components/main-filter-calendar';

const [dateRange, setDateRange] = useState<DateRange | undefined>();

<MainFilterCalendar 
    value={dateRange} 
    onChange={setDateRange}
/>
```

**Design Standards**:
- **Height**: `h-9` (36px) for consistent form element sizing
- **Color Scheme**: Gray variants throughout (`gray-50` to `gray-900`)
- **Spacing**: `gap-2` between elements, compact padding (`px-3 py-1`)
- **Typography**: Spanish localization with proper date formatting

**Period Groups**:
- **Diarios**: Hoy, Ayer, Últimos 7 días, Últimos 30 días
- **Semanales**: Esta semana, Semana pasada, Últimas 4 semanas  
- **Mensuales**: Este mes, Mes pasado, Últimos 3/6/12 meses

**State Management**:
- Uses custom `useDateRange` hook for centralized logic
- Auto-initializes with today's date as default
- Maintains temporary selection state during interaction
- Supports both period selection and manual date picking

**Accessibility**:
- Full WCAG 2.1 compliance with ARIA labels
- Keyboard navigation support
- Screen reader friendly with Spanish announcements
- Semantic HTML structure with proper roles

**Performance**:
- React.memo optimization for sub-components
- useMemo/useCallback for expensive calculations
- Optimized dependency arrays to prevent unnecessary re-renders

### WeeklyChartComparison Component

A comprehensive chart component for displaying 3-week sales comparison data in an interactive line chart format. Built with Recharts for optimal performance and accessibility.

**Location**: `@/components/weekly-chart-comparison`

**Key Features**:
- **Interactive Line Chart**: 3-week daily sales comparison with hover tooltips
- **Conditional Rendering**: Only displays when exactly one complete week is selected
- **Spanish Localization**: Day names and currency formatting for Mexican market
- **Theme Integration**: Fully compatible with light/dark mode theme system
- **Responsive Design**: Adapts to mobile and desktop screen sizes
- **Performance Optimized**: Memoized components and efficient re-rendering

**Architecture**:
```
weekly-chart-comparison/
├── weekly-chart-comparison.tsx           # Main container component
├── types.ts                              # TypeScript interfaces
├── utils.ts                              # Data generation & validation utilities
├── index.ts                              # Export configuration
└── components/
    ├── weekly-chart-header.tsx           # Header with icon, title, subtitle
    └── weekly-comparison-chart.tsx       # Recharts line chart implementation
```

**Technical Implementation**:
- **Chart Library**: Recharts for React + TypeScript compatibility
- **Data Validation**: Comprehensive runtime validation with development logging
- **Currency Formatting**: Mexican peso with proper locale support
- **Theme Colors**: Uses primary color (#897053) with gradient variations
- **Grid System**: Horizontal grid lines with theme-adaptive colors
- **Focus Management**: Removed unwanted focus outlines while maintaining accessibility

**Visual Design**:
- **Chart Type**: Multi-line chart with 3 colored lines representing different weeks
- **X-Axis**: Spanish day abbreviations (LUN, MAR, MIÉ, JUE, VIE, SÁB, DOM)
- **Y-Axis**: Hidden for clean appearance, values shown in tooltips
- **Legend**: Week labels with color coding
- **Tooltip**: Enhanced popup showing day name and formatted peso amounts

**Data Structure**:
```typescript
interface WeeklyChartData {
  dailyData: ChartDayData[];        // 7 days of sales data
  weekLabels: string[];             // ['Semana 1', 'Semana 2', 'Semana 3']
  weekColors: string[];             // ['#897053', '#6b5d4a', '#4a3d2f']
}

interface ChartDayData {
  dayName: string;                  // Short day name (LUN, MAR, etc.)
  fullDayName: string;              // Full day name (Lunes, Martes, etc.)
  week1: number;                    // Sales amount for week 1
  week2: number;                    // Sales amount for week 2
  week3: number;                    // Sales amount for week 3
}
```

**Integration**:
- **Dashboard Placement**: Positioned below `weekly-sales-comparison` component
- **Date Range Integration**: Uses same validation logic as other weekly components
- **Theme System**: Automatically adapts colors based on CSS variables
- **Mock Data**: Realistic business patterns with weekday/weekend variations

**Performance Features**:
- **React.memo**: Deep comparison memoization for chart data
- **useMemo**: Optimized data generation and validation
- **Lazy Rendering**: Only renders when complete week is selected
- **Development Mode**: Additional validation and logging for debugging

## Theme System

### Comprehensive Light/Dark Mode Implementation

**Primary Color**: #897053 (warm brown) for buttons, icons, and avatars across all components
**Background Colors**: #F8F8F8 (light) / #1A1A1A (dark) for main app background
**Card Colors**: #EFEFEF (light) / #2C2C2C (dark) for component backgrounds

**CSS Variables Structure**:
```css
:root {
  --primary: #897053;              /* Buttons, icons, avatars */
  --background: #F8F8F8;           /* Main app background */
  --foreground: #5A5A5A;           /* Primary text */
  --card: #EFEFEF;                 /* Card backgrounds */
  --border: #D1D5DB;               /* Borders and dividers */
  --accent: #64B5F6;               /* Links and accents */
  --destructive: #EF4444;          /* Error states */
}

.dark {
  --background: #1A1A1A;           
  --foreground: #E0E0E0;           
  --card: #2C2C2C;                 
  --border: #3F3F3F;               
  /* Primary color remains consistent in both modes */
}
```

**Component Integration**:
- All sales components use semantic CSS classes (`bg-primary`, `text-foreground`, etc.)
- Automatic theme switching without component-level changes
- Focus ring and interaction states properly themed
- Chart components adapt grid and text colors based on theme